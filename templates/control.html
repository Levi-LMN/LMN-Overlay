<!-- templates/control.html - UPDATED VERSION WITH POSITION & SIZE CONTROLS -->
{% extends "base.html" %}
{% block title %}Control Panel - {{ company_name }} Overlay{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="mb-4 space-y-2">
                {% for category, message in messages %}
                    <div class="flash-message px-4 py-3 rounded-lg shadow-sm flex items-center justify-between
                                {% if category == 'error' %}bg-red-50 border-l-4 border-red-500 text-red-800
                                {% elif category == 'success' %}bg-green-50 border-l-4 border-green-500 text-green-800
                                {% else %}bg-blue-50 border-l-4 border-blue-500 text-blue-800{% endif %}">
                        <span class="font-medium">{{ message }}</span>
                        <button onclick="this.parentElement.remove()" class="text-gray-500 hover:text-gray-700 text-xl">×</button>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <!-- Upload Progress Modal -->
    <div id="uploadModal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
            <div class="text-center">
                <svg class="animate-spin h-12 w-12 mx-auto text-blue-600 mb-4" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <h3 class="text-lg font-semibold mb-2">Uploading Image</h3>
                <p class="text-sm text-gray-600 mb-4" id="uploadStatus">Preparing...</p>
                <div class="w-full bg-gray-200 rounded-full h-2.5">
                    <div id="uploadProgress" class="bg-blue-600 h-2.5 rounded-full" style="width: 0%"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Phrases Modal -->
    <div id="phrasesModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
        <div class="relative top-20 mx-auto p-5 border w-full max-w-2xl shadow-lg rounded-lg bg-white">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold">Edit Secondary Text Phrases</h3>
                <button onclick="closePhrasesModal()" class="text-gray-400 hover:text-gray-600">×</button>
            </div>
            <div id="phrasesList" class="space-y-2 max-h-96 overflow-y-auto mb-4"></div>
            <button onclick="addNewPhrase()" class="w-full px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">
                + Add New Phrase
            </button>
            <div class="flex gap-3 mt-4">
                <button onclick="closePhrasesModal()" class="flex-1 px-4 py-2 bg-gray-200 rounded">Cancel</button>
                <button onclick="savePhrases()" class="flex-1 px-4 py-2 bg-blue-600 text-white rounded">Save</button>
            </div>
        </div>
    </div>

    <!-- Category Tabs -->
    <div class="bg-white rounded-lg shadow-sm mb-4">
        <nav class="flex border-b">
            {% for cat in categories %}
            <button onclick="switchCategory('{{ cat }}')" id="tab-{{ cat }}"
                    class="category-tab py-3 px-6 border-b-2 font-medium text-sm
                           {% if loop.first %}border-blue-500 text-blue-600{% else %}border-transparent text-gray-500{% endif %}">
                {{ cat.capitalize() }}
            </button>
            {% endfor %}
        </nav>
    </div>

    <!-- Category Content -->
    {% for cat in categories %}
    <div id="content-{{ cat }}" class="category-content {% if not loop.first %}hidden{% endif %}">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">

            <!-- LEFT COLUMN -->
            <div class="space-y-4">
                <!-- Master Control -->
                <div class="bg-white p-4 rounded-lg shadow-sm">
                    <h2 class="text-lg font-semibold mb-3">Master Control</h2>
                    <div class="flex items-center justify-between mb-3">
                        <span class="font-medium">Overlay Visibility</span>
                        <button onclick="toggleVisibility('{{ cat }}')" id="visibility-{{ cat }}"
                                class="relative inline-flex h-6 w-11 items-center rounded-full
                                       {% if settings[cat].is_visible %}bg-green-500{% else %}bg-gray-300{% endif %}">
                            <span class="inline-block h-4 w-4 rounded-full bg-white transition
                                       {% if settings[cat].is_visible %}translate-x-6{% else %}translate-x-1{% endif %}"></span>
                        </button>
                    </div>
                    <p class="text-xs text-gray-500">Display URL: <code class="bg-gray-100 px-2 py-1 rounded">{{ request.url_root }}display?category={{ cat }}</code></p>
                </div>

                <!-- Content -->
                <div class="bg-white p-4 rounded-lg shadow-sm">
                    <h2 class="text-lg font-semibold mb-3">Content</h2>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-xs font-medium mb-1">Main Text</label>
                            <input type="text" id="main_text-{{ cat }}" value="{{ settings[cat].main_text or '' }}"
                                   onchange="updateSetting('{{ cat }}', 'main_text', this.value)"
                                   class="w-full px-3 py-2 text-sm border rounded-md focus:ring-2 focus:ring-blue-500">
                        </div>

                        <div class="border-2 border-blue-200 rounded-lg p-3 bg-blue-50">
                            <div class="flex items-center justify-between mb-2">
                                <label class="text-xs font-medium">Secondary Text (Multi-Phrase)</label>
                                <button onclick="openPhrasesEditor('{{ cat }}')"
                                        class="px-3 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700">
                                    Edit Phrases
                                </button>
                            </div>
                            <div class="flex items-center mb-2">
                                <input type="checkbox" id="secondary_rotation-{{ cat }}"
                                       {% if settings[cat].secondary_rotation_enabled %}checked{% endif %}
                                       onchange="updateSetting('{{ cat }}', 'secondary_rotation_enabled', this.checked)"
                                       class="h-4 w-4 text-blue-600 rounded">
                                <label for="secondary_rotation-{{ cat }}" class="ml-2 text-xs">Enable Rotation</label>
                            </div>
                            <div id="phrase-preview-{{ cat }}" class="text-xs text-gray-600 italic">
                                {% set phrases = settings[cat].get_secondary_phrases_list() %}
                                {{ phrases|length if phrases else 0 }} phrase{{ 's' if phrases|length != 1 else '' }}
                            </div>
                        </div>

                        <div>
                            <label class="block text-xs font-medium mb-1">Ticker Text</label>
                            <textarea id="ticker_text-{{ cat }}" onchange="updateSetting('{{ cat }}', 'ticker_text', this.value)" rows="2"
                                      class="w-full px-3 py-2 text-sm border rounded-md">{{ settings[cat].ticker_text or '' }}</textarea>
                        </div>

                        <div>
                            <label class="block text-xs font-medium mb-1">Company Name</label>
                            <input type="text" id="company_name-{{ cat }}" value="{{ settings[cat].company_name or '' }}"
                                   onchange="updateSetting('{{ cat }}', 'company_name', this.value)"
                                   class="w-full px-3 py-2 text-sm border rounded-md">
                        </div>
                    </div>
                </div>

                <!-- Position & Size Controls - NEW SECTION -->
                <div class="bg-white p-4 rounded-lg shadow-sm border-2 border-purple-200">
                    <h2 class="text-lg font-semibold mb-3 text-purple-700">Position & Size</h2>

                    <!-- Vertical Position -->
                    <div class="mb-4">
                        <label class="block text-xs font-medium mb-2">Vertical Position</label>
                        <select id="vertical_position-{{ cat }}" onchange="updateSetting('{{ cat }}', 'vertical_position', this.value)"
                                class="w-full px-3 py-2 text-sm border rounded-md">
                            <option value="top" {% if settings[cat].vertical_position == 'top' %}selected{% endif %}>Top</option>
                            <option value="center" {% if settings[cat].vertical_position == 'center' %}selected{% endif %}>Center</option>
                            <option value="bottom" {% if settings[cat].vertical_position == 'bottom' %}selected{% endif %}>Bottom</option>
                            <option value="custom" {% if settings[cat].vertical_position == 'custom' %}selected{% endif %}>Custom</option>
                        </select>

                        <!-- Custom vertical controls (show when custom is selected) -->
                        <div id="custom-vertical-{{ cat }}" class="mt-2 space-y-2 {% if settings[cat].vertical_position != 'custom' %}hidden{% endif %}">
                            <div>
                                <label class="block text-xs mb-1">Top: <span id="custom_top_val-{{ cat }}">{{ settings[cat].custom_top }}</span>px</label>
                                <input type="range" id="custom_top-{{ cat }}" min="0" max="1080" step="10"
                                       value="{{ settings[cat].custom_top }}"
                                       oninput="document.getElementById('custom_top_val-{{ cat }}').textContent = this.value"
                                       onchange="updateSetting('{{ cat }}', 'custom_top', this.value)"
                                       class="w-full">
                            </div>
                            <div>
                                <label class="block text-xs mb-1">Bottom: <span id="custom_bottom_val-{{ cat }}">{{ settings[cat].custom_bottom }}</span>px</label>
                                <input type="range" id="custom_bottom-{{ cat }}" min="0" max="1080" step="10"
                                       value="{{ settings[cat].custom_bottom }}"
                                       oninput="document.getElementById('custom_bottom_val-{{ cat }}').textContent = this.value"
                                       onchange="updateSetting('{{ cat }}', 'custom_bottom', this.value)"
                                       class="w-full">
                            </div>
                        </div>
                    </div>

                    <!-- Horizontal Position -->
                    <div class="mb-4">
                        <label class="block text-xs font-medium mb-2">Horizontal Position</label>
                        <select id="horizontal_position-{{ cat }}" onchange="updateSetting('{{ cat }}', 'horizontal_position', this.value)"
                                class="w-full px-3 py-2 text-sm border rounded-md">
                            <option value="left" {% if settings[cat].horizontal_position == 'left' %}selected{% endif %}>Left</option>
                            <option value="center" {% if settings[cat].horizontal_position == 'center' %}selected{% endif %}>Center</option>
                            <option value="right" {% if settings[cat].horizontal_position == 'right' %}selected{% endif %}>Right</option>
                            <option value="custom" {% if settings[cat].horizontal_position == 'custom' %}selected{% endif %}>Custom</option>
                        </select>

                        <!-- Custom horizontal controls -->
                        <div id="custom-horizontal-{{ cat }}" class="mt-2 space-y-2 {% if settings[cat].horizontal_position != 'custom' %}hidden{% endif %}">
                            <div>
                                <label class="block text-xs mb-1">Left: <span id="custom_left_val-{{ cat }}">{{ settings[cat].custom_left }}</span>px</label>
                                <input type="range" id="custom_left-{{ cat }}" min="0" max="1920" step="10"
                                       value="{{ settings[cat].custom_left }}"
                                       oninput="document.getElementById('custom_left_val-{{ cat }}').textContent = this.value"
                                       onchange="updateSetting('{{ cat }}', 'custom_left', this.value)"
                                       class="w-full">
                            </div>
                            <div>
                                <label class="block text-xs mb-1">Right: <span id="custom_right_val-{{ cat }}">{{ settings[cat].custom_right }}</span>px</label>
                                <input type="range" id="custom_right-{{ cat }}" min="0" max="1920" step="10"
                                       value="{{ settings[cat].custom_right }}"
                                       oninput="document.getElementById('custom_right_val-{{ cat }}').textContent = this.value"
                                       onchange="updateSetting('{{ cat }}', 'custom_right', this.value)"
                                       class="w-full">
                            </div>
                        </div>
                    </div>

                    <!-- Container Width -->
                    <div class="mb-4">
                        <label class="block text-xs font-medium mb-2">Container Width</label>
                        <select id="container_width-{{ cat }}" onchange="updateSetting('{{ cat }}', 'container_width', this.value)"
                                class="w-full px-3 py-2 text-sm border rounded-md">
                            <option value="auto" {% if settings[cat].container_width == 'auto' %}selected{% endif %}>Auto</option>
                            <option value="full" {% if settings[cat].container_width == 'full' %}selected{% endif %}>Full Width</option>
                            <option value="custom" {% if settings[cat].container_width == 'custom' %}selected{% endif %}>Custom</option>
                        </select>

                        <div id="custom-width-{{ cat }}" class="mt-2 {% if settings[cat].container_width != 'custom' %}hidden{% endif %}">
                            <label class="block text-xs mb-1">Width: <span id="custom_width_val-{{ cat }}">{{ settings[cat].custom_width }}</span>px</label>
                            <input type="range" id="custom_width-{{ cat }}" min="300" max="1920" step="10"
                                   value="{{ settings[cat].custom_width }}"
                                   oninput="document.getElementById('custom_width_val-{{ cat }}').textContent = this.value"
                                   onchange="updateSetting('{{ cat }}', 'custom_width', this.value)"
                                   class="w-full">
                        </div>

                        <!-- Min/Max Width Controls -->
                        <div class="mt-2 space-y-2">
                            <div>
                                <label class="block text-xs mb-1">Min Width: <span id="container_min_width_val-{{ cat }}">{{ settings[cat].container_min_width }}</span>px</label>
                                <input type="range" id="container_min_width-{{ cat }}" min="200" max="1200" step="10"
                                       value="{{ settings[cat].container_min_width }}"
                                       oninput="document.getElementById('container_min_width_val-{{ cat }}').textContent = this.value"
                                       onchange="updateSetting('{{ cat }}', 'container_min_width', this.value)"
                                       class="w-full">
                            </div>
                            <div>
                                <label class="block text-xs mb-1">Max Width: <span id="container_max_width_val-{{ cat }}">{{ settings[cat].container_max_width }}</span>px</label>
                                <input type="range" id="container_max_width-{{ cat }}" min="600" max="1920" step="10"
                                       value="{{ settings[cat].container_max_width }}"
                                       oninput="document.getElementById('container_max_width_val-{{ cat }}').textContent = this.value"
                                       onchange="updateSetting('{{ cat }}', 'container_max_width', this.value)"
                                       class="w-full">
                            </div>
                        </div>
                    </div>

                    <!-- Container Height -->
                    <div class="mb-4">
                        <label class="block text-xs font-medium mb-2">Container Height</label>
                        <select id="container_height-{{ cat }}" onchange="updateSetting('{{ cat }}', 'container_height', this.value)"
                                class="w-full px-3 py-2 text-sm border rounded-md">
                            <option value="auto" {% if settings[cat].container_height == 'auto' %}selected{% endif %}>Auto</option>
                            <option value="custom" {% if settings[cat].container_height == 'custom' %}selected{% endif %}>Custom</option>
                        </select>

                        <div id="custom-height-{{ cat }}" class="mt-2 {% if settings[cat].container_height != 'custom' %}hidden{% endif %}">
                            <label class="block text-xs mb-1">Height: <span id="custom_height_val-{{ cat }}">{{ settings[cat].custom_height }}</span>px</label>
                            <input type="range" id="custom_height-{{ cat }}" min="100" max="1080" step="10"
                                   value="{{ settings[cat].custom_height }}"
                                   oninput="document.getElementById('custom_height_val-{{ cat }}').textContent = this.value"
                                   onchange="updateSetting('{{ cat }}', 'custom_height', this.value)"
                                   class="w-full">
                        </div>
                    </div>

                    <!-- Container Padding -->
                    <div>
                        <label class="block text-xs font-medium mb-1">
                            Container Padding: <span id="container_padding_val-{{ cat }}">{{ settings[cat].container_padding }}</span>px
                        </label>
                        <input type="range" id="container_padding-{{ cat }}" min="0" max="100" step="5"
                               value="{{ settings[cat].container_padding }}"
                               oninput="document.getElementById('container_padding_val-{{ cat }}').textContent = this.value"
                               onchange="updateSetting('{{ cat }}', 'container_padding', this.value)"
                               class="w-full">
                    </div>
                </div>

                <!-- Text Scaling Controls - NEW SECTION -->
                <div class="bg-white p-4 rounded-lg shadow-sm border-2 border-indigo-200">
                    <h2 class="text-lg font-semibold mb-3 text-indigo-700">Text Scaling</h2>

                    <div class="space-y-3">
                        <div>
                            <label class="block text-xs font-medium mb-2">Scale Mode</label>
                            <select id="text_scale_mode-{{ cat }}" onchange="updateSetting('{{ cat }}', 'text_scale_mode', this.value)"
                                    class="w-full px-3 py-2 text-sm border rounded-md">
                                <option value="responsive" {% if settings[cat].text_scale_mode == 'responsive' %}selected{% endif %}>Responsive (Auto-scale)</option>
                                <option value="fixed" {% if settings[cat].text_scale_mode == 'fixed' %}selected{% endif %}>Fixed Size</option>
                                <option value="fit" {% if settings[cat].text_scale_mode == 'fit' %}selected{% endif %}>Fit to Container</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-xs font-medium mb-1">
                                Line Height: <span id="text_line_height_val-{{ cat }}">{{ settings[cat].text_line_height }}</span>
                            </label>
                            <input type="range" id="text_line_height-{{ cat }}" min="0.8" max="2.5" step="0.1"
                                   value="{{ settings[cat].text_line_height }}"
                                   oninput="document.getElementById('text_line_height_val-{{ cat }}').textContent = this.value"
                                   onchange="updateSetting('{{ cat }}', 'text_line_height', this.value)"
                                   class="w-full">
                        </div>

                        <div>
                            <label class="block text-xs font-medium mb-1">
                                Max Lines: <span id="text_max_lines_val-{{ cat }}">{{ settings[cat].text_max_lines }}</span>
                            </label>
                            <input type="range" id="text_max_lines-{{ cat }}" min="1" max="5" step="1"
                                   value="{{ settings[cat].text_max_lines }}"
                                   oninput="document.getElementById('text_max_lines_val-{{ cat }}').textContent = this.value"
                                   onchange="updateSetting('{{ cat }}', 'text_max_lines', this.value)"
                                   class="w-full">
                        </div>

                        <div class="flex items-center">
                            <input type="checkbox" id="enable_text_truncation-{{ cat }}"
                                   {% if settings[cat].enable_text_truncation %}checked{% endif %}
                                   onchange="updateSetting('{{ cat }}', 'enable_text_truncation', this.checked)"
                                   class="h-4 w-4">
                            <label for="enable_text_truncation-{{ cat }}" class="ml-2 text-xs">Enable Text Truncation (...)</label>
                        </div>
                    </div>
                </div>

                <!-- Rotation Settings -->
                <div class="bg-white p-4 rounded-lg shadow-sm">
                    <h2 class="text-lg font-semibold mb-3">Phrase Rotation</h2>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-xs font-medium mb-1">
                                Display Duration: <span id="secondary_display_duration_val-{{ cat }}">{{ settings[cat].secondary_display_duration }}</span>s
                            </label>
                            <input type="range" id="secondary_display_duration-{{ cat }}" min="1" max="10" step="0.5"
                                   value="{{ settings[cat].secondary_display_duration }}"
                                   oninput="document.getElementById('secondary_display_duration_val-{{ cat }}').textContent = this.value"
                                   onchange="updateSetting('{{ cat }}', 'secondary_display_duration', this.value)"
                                   class="w-full">
                        </div>
                        <div>
                            <label class="block text-xs font-medium mb-1">Transition Effect</label>
                            <select id="secondary_transition_type-{{ cat }}" onchange="updateSetting('{{ cat }}', 'secondary_transition_type', this.value)"
                                    class="w-full px-3 py-2 text-sm border rounded-md">
                                <option value="fade" {% if settings[cat].secondary_transition_type == 'fade' %}selected{% endif %}>Fade</option>
                                <option value="slide-left" {% if settings[cat].secondary_transition_type == 'slide-left' %}selected{% endif %}>Slide Left</option>
                                <option value="slide-right" {% if settings[cat].secondary_transition_type == 'slide-right' %}selected{% endif %}>Slide Right</option>
                                <option value="slide-up" {% if settings[cat].secondary_transition_type == 'slide-up' %}selected{% endif %}>Slide Up</option>
                                <option value="slide-down" {% if settings[cat].secondary_transition_type == 'slide-down' %}selected{% endif %}>Slide Down</option>
                                <option value="zoom" {% if settings[cat].secondary_transition_type == 'zoom' %}selected{% endif %}>Zoom</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-medium mb-1">
                                Speed: <span id="secondary_transition_duration_val-{{ cat }}">{{ settings[cat].secondary_transition_duration }}</span>s
                            </label>
                            <input type="range" id="secondary_transition_duration-{{ cat }}" min="0.2" max="2" step="0.1"
                                   value="{{ settings[cat].secondary_transition_duration }}"
                                   oninput="document.getElementById('secondary_transition_duration_val-{{ cat }}').textContent = this.value"
                                   onchange="updateSetting('{{ cat }}', 'secondary_transition_duration', this.value)"
                                   class="w-full">
                        </div>
                    </div>
                </div>

                <!-- Images -->
                <div class="bg-white p-4 rounded-lg shadow-sm">
                    <h2 class="text-lg font-semibold mb-3">Images</h2>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-xs font-medium mb-1">Company Logo</label>
                            <input type="file" accept="image/*" onchange="uploadImage('{{ cat }}', 'logo', this)"
                                   class="w-full text-xs file:mr-2 file:py-1 file:px-3 file:rounded file:border-0 file:bg-blue-50 file:text-blue-700">
                            {% if settings[cat].company_logo %}
                            <div class="mt-2 flex items-center gap-2">
                                <img src="{{ url_for('static', filename=settings[cat].company_logo) }}" class="h-16 border rounded">
                                <button onclick="removeLogo('{{ cat }}')" class="px-3 py-1 bg-red-600 text-white text-xs rounded">Remove</button>
                            </div>
                            {% endif %}
                            <div class="flex items-center mt-2">
                                <input type="checkbox" id="show_logo-{{ cat }}" {% if settings[cat].show_company_logo %}checked{% endif %}
                                       onchange="updateSetting('{{ cat }}', 'show_company_logo', this.checked)" class="h-4 w-4">
                                <label for="show_logo-{{ cat }}" class="ml-2 text-xs">Show Logo</label>
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs font-medium mb-1">{{ cat.capitalize() }} Image</label>
                            <input type="file" accept="image/*" onchange="uploadImage('{{ cat }}', 'image', this)"
                                   class="w-full text-xs file:mr-2 file:py-1 file:px-3 file:rounded file:border-0 file:bg-blue-50 file:text-blue-700">
                            {% if settings[cat].category_image %}
                            <img src="{{ url_for('static', filename=settings[cat].category_image) }}" class="mt-2 h-24 border rounded">
                            {% endif %}
                            <div class="flex items-center mt-2">
                                <input type="checkbox" id="show_image-{{ cat }}" {% if settings[cat].show_category_image %}checked{% endif %}
                                       onchange="updateSetting('{{ cat }}', 'show_category_image', this.checked)" class="h-4 w-4">
                                <label for="show_image-{{ cat }}" class="ml-2 text-xs">Show Image</label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Animations -->
                <div class="bg-white p-4 rounded-lg shadow-sm">
                    <h2 class="text-lg font-semibold mb-3">Animations</h2>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-xs font-medium mb-1">Container Entrance</label>
                            <select id="entrance_animation-{{ cat }}" onchange="updateSetting('{{ cat }}', 'entrance_animation', this.value)"
                                    class="w-full px-3 py-2 text-sm border rounded-md">
                                <option value="slide-left" {% if settings[cat].entrance_animation == 'slide-left' %}selected{% endif %}>Slide Left</option>
                                <option value="slide-right" {% if settings[cat].entrance_animation == 'slide-right' %}selected{% endif %}>Slide Right</option>
                                <option value="slide-up" {% if settings[cat].entrance_animation == 'slide-up' %}selected{% endif %}>Slide Up</option>
                                <option value="fade-in" {% if settings[cat].entrance_animation == 'fade-in' %}selected{% endif %}>Fade In</option>
                                <option value="zoom-in" {% if settings[cat].entrance_animation == 'zoom-in' %}selected{% endif %}>Zoom In</option>
                                <option value="none" {% if settings[cat].entrance_animation == 'none' %}selected{% endif %}>None</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-medium mb-1">
                                Duration: <span id="entrance_duration_val-{{ cat }}">{{ settings[cat].entrance_duration }}</span>s
                            </label>
                            <input type="range" id="entrance_duration-{{ cat }}" min="0.3" max="3" step="0.1"
                                   value="{{ settings[cat].entrance_duration }}"
                                   oninput="document.getElementById('entrance_duration_val-{{ cat }}').textContent = this.value"
                                   onchange="updateSetting('{{ cat }}', 'entrance_duration', this.value)" class="w-full">
                        </div>
                        <div>
                            <label class="block text-xs font-medium mb-1">Text Animation</label>
                            <select id="text_animation-{{ cat }}" onchange="updateSetting('{{ cat }}', 'text_animation', this.value)"
                                    class="w-full px-3 py-2 text-sm border rounded-md">
                                <option value="none" {% if settings[cat].text_animation == 'none' %}selected{% endif %}>None</option>
                                <option value="typewriter" {% if settings[cat].text_animation == 'typewriter' %}selected{% endif %}>Typewriter</option>
                                <option value="fade-in-words" {% if settings[cat].text_animation == 'fade-in-words' %}selected{% endif %}>Fade Words</option>
                                <option value="slide-in-chars" {% if settings[cat].text_animation == 'slide-in-chars' %}selected{% endif %}>Slide Chars</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- RIGHT COLUMN -->
            <div class="space-y-4">
                <!-- Colors -->
                <div class="bg-white p-4 rounded-lg shadow-sm">
                    <h2 class="text-lg font-semibold mb-3">Colors</h2>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-xs font-medium mb-1">Background</label>
                            <div class="flex gap-2">
                                <input type="color" id="bg_color-{{ cat }}" value="{{ settings[cat].bg_color }}"
                                       onchange="updateSetting('{{ cat }}', 'bg_color', this.value)" class="h-8 w-16">
                                <input type="text" value="{{ settings[cat].bg_color }}" readonly class="flex-1 px-2 py-1 text-xs border rounded bg-gray-50">
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs font-medium mb-1">Accent</label>
                            <div class="flex gap-2">
                                <input type="color" id="accent_color-{{ cat }}" value="{{ settings[cat].accent_color }}"
                                       onchange="updateSetting('{{ cat }}', 'accent_color', this.value)" class="h-8 w-16">
                                <input type="text" value="{{ settings[cat].accent_color }}" readonly class="flex-1 px-2 py-1 text-xs border rounded bg-gray-50">
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs font-medium mb-1">Text</label>
                            <div class="flex gap-2">
                                <input type="color" id="text_color-{{ cat }}" value="{{ settings[cat].text_color }}"
                                       onchange="updateSetting('{{ cat }}', 'text_color', this.value)" class="h-8 w-16">
                                <input type="text" value="{{ settings[cat].text_color }}" readonly class="flex-1 px-2 py-1 text-xs border rounded bg-gray-50">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Typography -->
                <div class="bg-white p-4 rounded-lg shadow-sm">
                    <h2 class="text-lg font-semibold mb-3">Typography</h2>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-xs font-medium mb-1">
                                Main: <span id="main_font_size_val-{{ cat }}">{{ settings[cat].main_font_size }}</span>px
                            </label>
                            <input type="range" id="main_font_size-{{ cat }}" min="16" max="72" value="{{ settings[cat].main_font_size }}"
                                   oninput="document.getElementById('main_font_size_val-{{ cat }}').textContent = this.value"
                                   onchange="updateSetting('{{ cat }}', 'main_font_size', this.value)" class="w-full">
                        </div>
                        <div>
                            <label class="block text-xs font-medium mb-1">
                                Secondary: <span id="secondary_font_size_val-{{ cat }}">{{ settings[cat].secondary_font_size }}</span>px
                            </label>
                            <input type="range" id="secondary_font_size-{{ cat }}" min="12" max="48" value="{{ settings[cat].secondary_font_size }}"
                                   oninput="document.getElementById('secondary_font_size_val-{{ cat }}').textContent = this.value"
                                   onchange="updateSetting('{{ cat }}', 'secondary_font_size', this.value)" class="w-full">
                        </div>
                        <div>
                            <label class="block text-xs font-medium mb-1">
                                Ticker: <span id="ticker_font_size_val-{{ cat }}">{{ settings[cat].ticker_font_size }}</span>px
                            </label>
                            <input type="range" id="ticker_font_size-{{ cat }}" min="12" max="32" value="{{ settings[cat].ticker_font_size }}"
                                   oninput="document.getElementById('ticker_font_size_val-{{ cat }}').textContent = this.value"
                                   onchange="updateSetting('{{ cat }}', 'ticker_font_size', this.value)" class="w-full">
                        </div>
                        <div>
                            <label class="block text-xs font-medium mb-1">Font Family</label>
                            <select id="font_family-{{ cat }}" onchange="updateSetting('{{ cat }}', 'font_family', this.value)"
                                    class="w-full px-3 py-2 text-sm border rounded-md">
                                <option value="Arial, sans-serif" {% if settings[cat].font_family == 'Arial, sans-serif' %}selected{% endif %}>Arial</option>
                                <option value="'Times New Roman', serif" {% if settings[cat].font_family == "'Times New Roman', serif" %}selected{% endif %}>Times New Roman</option>
                                <option value="Georgia, serif" {% if settings[cat].font_family == 'Georgia, serif' %}selected{% endif %}>Georgia</option>
                                <option value="Verdana, sans-serif" {% if settings[cat].font_family == 'Verdana, sans-serif' %}selected{% endif %}>Verdana</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Layout -->
                <div class="bg-white p-4 rounded-lg shadow-sm">
                    <h2 class="text-lg font-semibold mb-3">Layout</h2>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-xs font-medium mb-1">
                                Opacity: <span id="opacity_val-{{ cat }}">{{ settings[cat].opacity }}</span>
                            </label>
                            <input type="range" id="opacity-{{ cat }}" min="0.3" max="1" step="0.05" value="{{ settings[cat].opacity }}"
                                   oninput="document.getElementById('opacity_val-{{ cat }}').textContent = this.value"
                                   onchange="updateSetting('{{ cat }}', 'opacity', this.value)" class="w-full">
                        </div>
                        <div>
                            <label class="block text-xs font-medium mb-1">
                                Border Radius: <span id="border_radius_val-{{ cat }}">{{ settings[cat].border_radius }}</span>px
                            </label>
                            <input type="range" id="border_radius-{{ cat }}" min="0" max="50" value="{{ settings[cat].border_radius }}"
                                   oninput="document.getElementById('border_radius_val-{{ cat }}').textContent = this.value"
                                   onchange="updateSetting('{{ cat }}', 'border_radius', this.value)" class="w-full">
                        </div>
                        <div>
                            <label class="block text-xs font-medium mb-1">
                                Logo Size: <span id="logo_size_val-{{ cat }}">{{ settings[cat].logo_size }}</span>px
                            </label>
                            <input type="range" id="logo_size-{{ cat }}" min="40" max="200" value="{{ settings[cat].logo_size }}"
                                   oninput="document.getElementById('logo_size_val-{{ cat }}').textContent = this.value"
                                   onchange="updateSetting('{{ cat }}', 'logo_size', this.value)" class="w-full">
                        </div>
                        <div>
                            <label class="block text-xs font-medium mb-1">
                                Ticker Speed: <span id="ticker_speed_val-{{ cat }}">{{ settings[cat].ticker_speed }}</span>px/s
                            </label>
                            <input type="range" id="ticker_speed-{{ cat }}" min="20" max="100" value="{{ settings[cat].ticker_speed }}"
                                   oninput="document.getElementById('ticker_speed_val-{{ cat }}').textContent = this.value"
                                   onchange="updateSetting('{{ cat }}', 'ticker_speed', this.value)" class="w-full">
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" id="show_decorative-{{ cat }}" {% if settings[cat].show_decorative_elements %}checked{% endif %}
                                   onchange="updateSetting('{{ cat }}', 'show_decorative_elements', this.checked)" class="h-4 w-4">
                            <label for="show_decorative-{{ cat }}" class="ml-2 text-xs">Show Decorative Elements</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/control-panel.js') }}"></script>
{% endblock %}